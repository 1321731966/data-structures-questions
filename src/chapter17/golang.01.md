#### CPU上下文切换

由于Linux 是一个多任务操作系统，而且呢它支持远大于 CPU 数量的任务同时运行，但是 这些任务实际上并不是真的在同时运行，而是因为系统在很短的时间内，将 CPU 轮流分配给它们，造成多任务同时运行的错觉。 
而在每个任务运行前，CPU 都需要知道任务从哪里加载和从哪里开始运行，通常都会需要系统事先帮它设置好 CPU 寄存器和程序计数器(Program Counter, PC).

在CPU中，寄存器是CPU内置的容量小、但速度极快的内存。然而程序计数器，则是用来存储 CPU 正在执行的指令位置、或者即将执行的下一条指令位置。它们都是 CPU 在运行任何任务前，必须的依赖环境，因此也被叫做 CPU上下文.

CPU 上下文切换 ，就是先把前一个任务的 CPU 上下文（也就是 CPU 寄存器和程序计数器）保存起来，然后加载新任务的上下文到这些寄存器和程序计数器，最后再跳转到程序计数器所指的新位置，运行新任务。 而这些保存下来的上下文，会存储在系统内核中，并在任务重新调度执行时再次加载进来。这样就能保证任务原来的状态不受影响，让任务看起来还是连续运行.

#### 什么是任务

CPU 上下文切换无非就是更新了 CPU 寄存器的值嘛，但这些寄存器，本身就是为了快速运行任务而设计的，为什么会影响系统的 CPU 性能呢？ 

在解析这个问题前，我们需要先了解下操作系统管理的这些“任务”到底是什么呢？

进程和线程正是最常见的任务。但是除此之外，硬件通过触发信号，会导致中断处理程序的调用，也是一种常见的任务。

所以，根据任务的不同，CPU上下文切换可分为几种场景：

* 进程上下文切换
* 线程上下文切换
* 中断上下文切换
* 系统调用上下文切换

